<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Ślub Marty i Michała</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/all.min.css') }}"> 
    <link href="https://fonts.googleapis.com/css?family=Caveat|Quicksand&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <header class="header">
      <h1 class="heading">
        Marta & Michał
        <span class="heading-subtext"> Pobieramy się!</span>
      </h1>
    </header>
    <a data-scroll class="fixed-button" href="#rsvp" id="rsvpButton">RSVP</a> 
    <section class="section">
      {% if no_guests %}
      <h2 class="sub-heading">Cześć!</h2>
      {% elif one_guest %}
      <h2 class="sub-heading">Cześć {{guest}}!</h2>
      {% elif two_guests %}
      <h2 class="sub-heading">Cześć {{two_guests[0]}} oraz {{two_guests[1]}}!</h2>
      {% elif multiple_guests %}
      <h2 class="sub-heading">Cześć {% if multiple_guests %}{{ multiple_guests | join(', ') }}{% endif %}!</h2>
      {% endif %}
      {% if one_guest %}
      <p>Jest nam niezmiernie miło zaprosić Cię na nasz ślub. Poniżej znajdziesz kilka szczegółów co do lokalizacji oraz formularz który posimy wypełnić, tak abyśmy mogli dostosować menu do waszych potrzeb. Jeżeli cokolwiek się zmieni,
        formularz możesz wypełnić też później. Dostaniemy aktualizację :)</p>
      {% else %}
      <p>Jest nam niezmiernie miło zaprosić Was na nasz ślub. Poniżej znajdziecie kilka szczegółów co do lokalizacji oraz formularz który posimy wypełnić, tak abyśmy mogli dostosować menu do waszych potrzeb. Jeżeli cokolwiek się zmieni,
        formularz możecie wypełnić też później. Dostaniemy aktualizację :)</p>
      {% endif %}
    </section>
    <section class="section">
      <h2 class="sub-heading">Szczegóły naszego wielkiego dnia</h2>
      <div class="details">
        <i class="fas fa-calendar-check"></i>
        <h3 class="details-heading">Kiedy?</h3>
        <p>10 Sierpień 2024</p>
      </div>
      <div class="details">
        <i class="fas fa-map-marked-alt"></i>
        <h3 class="details-heading">Gdzie?</h3>
        <p><a rel="noopener" href="https://www.boathouse.pl/" target="_blank">Boathouse</a>, Warszawa, Wał Miedzeszyński 389A</p>
        <img class="resort-image" src="https://chrzcinyikomunie.pl/uploads/boathouse-restaurant-and-garden-lounge/zdjecie-prezentacji-boathouse-restaurant-and-garden-lounge-ver99.jpeg" alt="Resort" />
      </div>
      <div class="details">
        <i class="fas fa-reply"></i>
        <h3 class="details-heading" id="rsvp">RSVP</h3>
        <form id="myForm" method="POST", action="{{ url_for('main.process_form') }}">
          {% if no_guests %}
          
          {{ form.csrf_token }}
          {{ form.base_form.Field1.label }}
          {{ form.base_form.Field1 }}
          {{ form.base_form.Field2.label }}
          {{ form.base_form.Field2 }}
          {{ form.base_form.Field3.label }}
          {{ form.base_form.Field3 }}
          {{ form.base_form.Field4.label }}
          {{ form.base_form.Field4 }}
          {{ form.Field5.label }}
          {{ form.Field5 }}
          {{ form.base_form.Field9.label }}
          {{ form.base_form.Field9 }}
          {{ form.form_type(value='AnonymForm') }}


          {% elif one_guest %}

          {{ form.csrf_token }}
          {{ form.base_form.Field1.label }}
          {{ form.base_form.Field1 }}
          {{ form.base_form.Field2.label }}
          {{ form.base_form.Field2 }}
          {{ form.base_form.Field3.label }}
          {{ form.base_form.Field3 }}
          {{ form.base_form.Field4.label }}
          {{ form.base_form.Field4 }}
          {{ form.Field5.label }}
          {{ form.Field5 }}
          {{ form.Field6.label }}
          {{ form.Field6 }}
          {{ form.Field7.label }}
          {{ form.Field7 }}
          {{ form.base_form.Field9.label }}
          {{ form.base_form.Field9 }}
          {{ form.form_type(value='OneGuestForm') }}


          {% elif two_guests %}

          {{ form.csrf_token }}
          {{ form.base_form.Field1.label }}
          {{ form.base_form.Field1 }}
          {{ form.base_form.Field2.label }}
          {{ form.base_form.Field2 }}
          {{ form.base_form.Field3.label }}
          {{ form.base_form.Field3 }}
          {{ form.base_form.Field4.label }}
          {{ form.base_form.Field4 }}
          {{ form.Field5.label }}
          {{two_guests[0]}}
          {{ form.Field5 }}
          {{ form.Field6.label }}
          {{two_guests[1]}}
          {{ form.Field6 }}
          {{ form.base_form.Field9.label }}
          {{ form.base_form.Field9 }}
          {{ form.form_type(value='TwoGuestForm') }}


          {% elif multiple_guests %}

          {{ form.csrf_token }}
          {{ form.base_form.Field1.label }}
          {{ form.base_form.Field1 }}
          {{ form.base_form.Field2.label }}
          {{ form.base_form.Field2 }}
          {{ form.base_form.Field3.label }}
          {{ form.base_form.Field3 }}
          {{ form.base_form.Field4.label }}
          {{ form.base_form.Field4 }}
          {{ form.Field5.label }}
          {{multiple_guests[0]}}
          {{ form.Field5 }}
          {{ form.Field6.label }}
          {{multiple_guests[1]}}
          {{ form.Field6 }}
          {{ form.Field7.label }}
          {{multiple_guests[2]}}
          {{ form.Field7 }}
          {{ form.Field8.label }}
          {{multiple_guests[3]}}
          {{ form.Field8 }}
          {{ form.base_form.Field9.label }}
          {{ form.base_form.Field9 }}
          {{ form.form_type(value='MultipeGuestForm') }}



          {% endif %}
          <button type="button" id="submitBtn">Prześlij</button>
        </form>

        <div id="flashMessage"></div>

        <div id="loadingSpinner" style="display: none;">
          Chwileczkę...
        </div>
        <script>
          $(document).ready(function () {
              $("#submitBtn").click(function (event) {
                  event.preventDefault();
  
                  $("#loadingSpinner").show();
      
                  $.ajax({
                      type: "POST",
                      url: $("#myForm").attr("action"),
                      data: $("#myForm").serialize(),
                      success: function (response) {
                          $("#loadingSpinner").hide();
      
                          if (response.success) {
                              $("#flashMessage").html(response.message).css("color", "green").show();
                          } else {
                              $("#flashMessage").html(response.message).css("color", "red").show();
                          }
                      },
                      error: function (xhr) {
                          $("#loadingSpinner").hide();

                          if (xhr.status == 429) {
                            $('#flashMessage').html('Za dużo prób, spróbuj za mnutę.').css("color", "red").show();
                          } else {
                            $('#flashMessage').html('Wystąpił błąd którego nie oczekiwałem. Najlepiej napisz do nas na messengerze ;)').css("color", "red").show();
                          }
                      }
                  });
              });
          });
      </script>
      </script>
      </div>
    </section>
    <script src="static/js/smooth-scroll.polyfills.min.js"></script>
    <script defer>
      var scroll = new SmoothScroll('a[href*="#"]');
      var rsvpButton = document.getElementById('rsvpButton')
      rsvpButton.addEventListener('click',hideButton,false);

      function hideButton() {
        rsvpButton.style.display = 'none';
      }   
    </script>
  </body>
</html>